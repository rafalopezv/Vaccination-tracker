---
title: 'COVID-19:<span style="color: #ED0973;">PROGRESO</span> GLOBAL DE VACUNACIÓN'
output: 
  html_document: 
    css: style.css
---

```{r setup, warnings = FALSE, message = FALSE, include = FALSE}
knitr::opts_chunk$set(warnings = FALSE, message = FALSE, echo = FALSE)


library(tidyverse)
library(reactable)
library(sparkline)
library(htmltools)
library(htmlwidgets)
library(magrittr)

source("code/limpieza_1.R")
options(scipen = 999)
```

<br>

El proceso de vacunación no ocurre de la misma manera en las diferentes regiones del mundo. ¿Por qué algunos países avanzan a gran velocidad y por qué algunos otros apenas están comenzando?  <span style="color: #ED0973;">**En Avina estamos trabajando para que la vacuna sea un bien público universal**</span> y esperamos que este espacio ayude a generar conciencia sobre ello. Las grandes desigualdades nunca son justas, pero mucho menos cuando hay vidas en juego.

**La tabla es interactiva**. Cuando se hace click sobre el título de las columnas los registros se ordenan alfabéticamente si se trata de palabras, o de mayor a menor</span> (y viveversa) si se trata de números.  

Los datos provienen de [Our World in Data](https://github.com/owid/covid-19-data/blob/master/public/data/README.md) y [Johns Hopkins](https://github.com/CSSEGISandData/COVID-19)

<small>Realizado por [Rafael López V.](https://rafalopezv.io/) y [Juan Cristóbal Birbuet](https://www.linkedin.com/in/juan-cristóbal-birbuet-rosazza-b563208/)</small>
<br>
```{r echo = FALSE}
### función para la barra de progreso


bar_chart <-
  function(label,
           width = "100%",
           height = "16px",
           fill = "#00bfc4",
           background = NULL) {
    bar <-
      div(style = list(
        background = fill,
        width = width,
        height = height
      ))
    chart <-
      div(style = list(
        flexGrow = 1,
        marginLeft = "8px",
        background = background
      ),
      bar)
    div(style = list(display = "flex", alignItems = "center"), label, chart)
  }

# funcion de colores 
make_color_pal <- function(colors, bias = 1) {
  get_color <- colorRamp(colors, bias = bias)
  function(x)
    rgb(get_color(x), maxColorValue = 255)
}


reactable(
    temp,
    pagination = FALSE,
    showSortIcon = FALSE,
    highlight = TRUE,
    compact = TRUE,
    searchable = TRUE,
    language = reactableLang(
      searchPlaceholder = "Buscar país"
    ),
    defaultSorted = "people_vaccinated_per_hundred",
    defaultSortOrder = "desc",
    defaultColDef = colDef(headerClass = "header colheader"),
    columnGroups = list(
      colGroup(
        name = "Curva de casos desde el principio de la pandemia [por semana]",
        columns = c("confirmados", "fallecidos"),
        headerClass = "groupheader"
      ),
      colGroup(
        name = "Contexto",
        columns = c("nombre_espanol", "date"),
        headerClass = "groupheader"
      ),
      colGroup(
        name = "Desempeño de la vacunación",
        columns = c("people_vaccinated_per_hundred", "people_fully_vaccinated_per_hundred", "total_boosters_per_hundred"),
        headerClass = "groupheader"
      )
    ),
    columns = list(
      confirmados = colDef(class = "sparkys",
                           name = "Infectados",
                           align = "center",
                           cell = function(values) {
    sparkline(values, type = "line", chartRangeMin = 0, height = "80%", width = "70%",
              fillColor = "#E1E1E1", lineColor = "#073B4C", lineWidth = 1.5)
  }),
  fallecidos = colDef(class = "sparkys",
                      name = "Falllecidos",
                      align = "center",
                      cell = function(values) {
    sparkline(values, type = "line", chartRangeMin = 0, height = "75%", width = "60%",
              fillColor = "#E1E1E1", lineColor = "#073B4C", lineWidth = 1.5)
  }),
      
    people_vaccinated_per_hundred = colDef(
        class = "cell number border-left",
        name = "Personas vacunadas con al menos una dosis [%]",
        align = "center",
        headerStyle = list(fontWeight = "400"),
        cell = function(value) {
          width <- paste0(value, "%")
          bar_chart(value,
                    width = width,
                    fill = "#ED0973",
                    background = "#E1E1E1")
        }
      ),
  
    people_fully_vaccinated_per_hundred = colDef(
        class = "cell number border-left",
        name = "Personas vacunadas con las dosis completas [%]",
        align = "center",
        headerStyle = list(fontWeight = "400"),
        cell = function(value) {
          width <- paste0(value, "%")
          bar_chart(value,
                    width = width,
                    fill = "#00bfc4",
                    background = "#E1E1E1")
        }
      ),
      
      total_boosters_per_hundred = colDef(
        class = "cell number border-left",
        name = "Personas vacunadas con dosis extras a las programadas incialmente [%]",
        align = "center",
        headerStyle = list(fontWeight = "400"),
        cell = function(value) {
          width <- paste0(value, "%")
          bar_chart(value,
                    width = width,
                    fill = "#073B4C",
                    background = "#E1E1E1")
        }
      ),
  
      date = colDef(name = "Actualización de la información", align = "center", 
                    width = 120, 
                    class = "division-name cell",
                    ),
  
  nombre_espanol = colDef(name = "País",
                          headerStyle = list(align = "center"),
                          class = "division-name cell")
    )
  )
    
```

<hr>
Descripción de las variables

- **Personas vacunadas con al menos una dosis [%]**: Número total de personas que recibieron al menos una dosis de alguna vacuna, por cada 100 personas de la población total del país.

- **Personas vacunadas con las dosis completas [%]**: Número total de personas que recibieron todas las dosis prescritas en el protocolo de vacunación, por cada 100 personas de la población total del país. Si bien la mayoría de las vacunas requieren la aplicación de dos dosis, algunas requieren una sola dosis. 

- **Personas vacunadas con dosis extras a las programadas inicialmente [%]**: Número total de dosis de refuerzo de la vacuna COVID-19, administradas por cada 100 personas de la población total del país. Se ha observado que después de algunos meses de haber recibido las dosis completas establecidas en el protocolo de vacunación, los anticuerpos generados decaen, por esta razón, en algunos países se ha autorizado el suministro de una dosis adicional de refuerzo. 

<hr>
Menciones

El diseño de la tabla fue inspirado en las siguientes fuentes:

- [New York Times](https://www.nytimes.com/interactive/2021/01/25/world/europe/global-vaccination-population-rate.html)
- [Kyle Cuilla](https://community.rstudio.com/t/2019-nfl-team-ratings-table-contest-submission/81205)
- [Reactable](https://glin.github.io/reactable/)

<hr>
[Código](https://github.com/rafalopezv/vaccines)

<br>